import{a as K,b as W,g as X,v as Y,d as Z}from"./user.CNPc-XGb.js";import{l as ee}from"./role.DKJrtvPU.js";import{l as ae}from"./post.CxoRXeHb.js";import{d as le}from"./dept.BemU79Ey.js";import{u as re}from"./dict.SjoGDUoM.js";import{v as se,d as f,r as p}from"./index.BLQPjP0P.js";import{a as te,r as b,y as oe,ae as u,af as de,o as i,b as v,G as r,H as o,Q as ue,E as h,u as t,M as _,a8 as y,U as I,V as k,e as me,x as ne,t as pe}from"./vue.DKOcwzik.js";import"./dict.CrgH2Vss.js";const ie={class:"system-user-dialog-container"},ce={class:"dialog-footer"},ge=te({name:"systemUserDialog",emits:["refresh"],setup(be,{expose:T,emit:C}){const{t:w}=se.useI18n(),$=C,{lock_flag:D}=re("lock_flag"),V=b(),c=b(!1),L=b([]),U=b([]),x=b([]),g=b(!1),a=oe({userId:"",username:"",password:"",salt:"",wxOpenid:"",qqOpenid:"",lockFlag:"0",phone:"",deptId:"",roleList:[],postList:[],nickname:"",name:"",email:"",post:[],role:[]}),N=b({username:[{validator:p.overLength,trigger:"blur"},{required:!0,message:"\u7528\u6237\u540D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{min:5,max:20,message:"\u7528\u6237\u540D\u79F0\u957F\u5EA6\u5FC5\u987B\u4ECB\u4E8E 5 \u548C 20 \u4E4B\u95F4",trigger:"blur"},{validator:(l,e,d)=>{Z(l,e,d,a.userId!=="")},trigger:"blur"}],password:[{validator:p.overLength,trigger:"blur"},{required:!0,message:"\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{min:6,max:20,message:"\u7528\u6237\u5BC6\u7801\u957F\u5EA6\u5FC5\u987B\u4ECB\u4E8E 5 \u548C 20 \u4E4B\u95F4",trigger:"blur"}],name:[{required:!0,message:"\u59D3\u540D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{validator:p.overLength,trigger:"blur"},{validator:p.chinese,trigger:"blur"}],deptId:[{required:!0,message:"\u90E8\u95E8\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],role:[{required:!0,message:"\u89D2\u8272\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],post:[{required:!0,message:"\u5C97\u4F4D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],phone:[{required:!0,message:"\u624B\u673A\u53F7\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{validator:p.overLength,trigger:"blur"},{validator:p.validatePhone,trigger:"blur"},{validator:(l,e,d)=>{Y(l,e,d,a.userId!=="")},trigger:"blur"}],email:[{validator:p.overLength,trigger:"blur"},{type:"email",message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u90AE\u7BB1\u5730\u5740",trigger:["blur","change"]}],lockFlag:[{required:!0,message:"\u72B6\u6001\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],nickname:[{validator:p.overLength,trigger:"blur"}]}),O=async()=>{if(!await V.value.validate().catch(()=>{}))return!1;try{const{userId:l,phone:e,password:d}=a;l?(e!=null&&e.includes("*")&&(a.phone=void 0),d!=null&&d.includes("******")&&(a.password=void 0),g.value=!0,await K(a),f().success(w("common.editSuccessText")),c.value=!1,$("refresh")):(g.value=!0,await W(a),f().success(w("common.addSuccessText")),c.value=!1,$("refresh"))}catch(l){f().error(l.msg)}finally{g.value=!1}},S=async l=>{try{g.value=!0;const{data:e}=await X(l);Object.assign(a,e),e.roleList&&(a.role=e.roleList.map(d=>d.roleId)),e.postList&&(a.post=e.postList.map(d=>d.postId)),e.dept&&(a.deptId=e.dept.deptId)}catch(e){f().error(e.msg)}finally{g.value=!1}},j=()=>{le().then(l=>{L.value=l.data,a.deptId=l.data[0].id})},E=()=>{ae().then(l=>{x.value=l.data,a.post=[l.data[0].postId]})},G=()=>{ee().then(l=>{U.value=l.data,a.role=[l.data[0].roleId]})};return T({openDialog:async l=>{c.value=!0,a.userId="",pe(()=>{var e;(e=V.value)==null||e.resetFields()}),j(),E(),G(),l&&(a.userId=l,await S(l),a.password="******")}}),(l,e)=>{const d=u("el-input"),m=u("el-form-item"),n=u("el-col"),q=u("el-option"),F=u("el-select"),H=u("el-tree-select"),M=u("el-radio"),P=u("el-radio-group"),Q=u("el-row"),R=u("el-form"),B=u("el-button"),z=u("el-dialog"),A=de("loading");return i(),v("div",ie,[r(z,{"close-on-click-modal":!1,title:t(a).userId?l.$t("common.editBtn"):l.$t("common.addBtn"),draggable:"",modelValue:t(c),"onUpdate:modelValue":e[11]||(e[11]=s=>ne(c)?c.value=s:null)},{footer:o(()=>[me("span",ce,[r(B,{onClick:e[10]||(e[10]=s=>c.value=!1)},{default:o(()=>[I(k(l.$t("common.cancelButtonText")),1)]),_:1}),r(B,{onClick:O,type:"primary",disabled:t(g)},{default:o(()=>[I(k(l.$t("common.confirmButtonText")),1)]),_:1},8,["disabled"])])]),default:o(()=>[ue((i(),h(R,{model:t(a),rules:t(N),"label-width":"90px",ref_key:"dataFormRef",ref:V},{default:o(()=>[r(Q,{gutter:20},{default:o(()=>[r(n,{span:12,class:"mb20"},{default:o(()=>[r(m,{label:l.$t("sysuser.username"),prop:"username"},{default:o(()=>[r(d,{disabled:t(a).userId!=="",placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",modelValue:t(a).username,"onUpdate:modelValue":e[0]||(e[0]=s=>t(a).username=s)},null,8,["disabled","modelValue"])]),_:1},8,["label"])]),_:1}),r(n,{span:12,class:"mb20"},{default:o(()=>[r(m,{label:l.$t("sysuser.password"),prop:"password"},{default:o(()=>[r(d,{clearable:"",placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801",type:"password",modelValue:t(a).password,"onUpdate:modelValue":e[1]||(e[1]=s=>t(a).password=s)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),r(n,{span:12,class:"mb20"},{default:o(()=>[r(m,{label:l.$t("sysuser.name"),prop:"name"},{default:o(()=>[r(d,{clearable:"",placeholder:"\u8BF7\u8F93\u5165\u59D3\u540D",modelValue:t(a).name,"onUpdate:modelValue":e[2]||(e[2]=s=>t(a).name=s)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),r(n,{span:12,class:"mb20"},{default:o(()=>[r(m,{label:l.$t("sysuser.phone"),prop:"phone"},{default:o(()=>[r(d,{clearable:"",placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7",modelValue:t(a).phone,"onUpdate:modelValue":e[3]||(e[3]=s=>t(a).phone=s)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),r(n,{span:12,class:"mb20"},{default:o(()=>[r(m,{label:l.$t("sysuser.role"),prop:"role"},{default:o(()=>[r(F,{class:"w100",clearable:"",multiple:"",placeholder:"\u8BF7\u9009\u62E9\u89D2\u8272",modelValue:t(a).role,"onUpdate:modelValue":e[4]||(e[4]=s=>t(a).role=s)},{default:o(()=>[(i(!0),v(_,null,y(t(U),s=>(i(),h(q,{key:s.roleId,label:s.roleName,value:s.roleId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1}),r(n,{span:12,class:"mb20"},{default:o(()=>[r(m,{label:l.$t("sysuser.post"),prop:"post"},{default:o(()=>[r(F,{class:"w100",clearable:"",multiple:"",placeholder:"\u8BF7\u9009\u62E9\u5C97\u4F4D",modelValue:t(a).post,"onUpdate:modelValue":e[5]||(e[5]=s=>t(a).post=s)},{default:o(()=>[(i(!0),v(_,null,y(t(x),s=>(i(),h(q,{key:s.postId,label:s.postName,value:s.postId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1}),r(n,{span:12,class:"mb20"},{default:o(()=>[r(m,{label:l.$t("sysuser.dept"),prop:"deptId"},{default:o(()=>[r(H,{data:t(L),props:{value:"id",label:"name",children:"children"},"check-strictly":"",class:"w100",clearable:"",placeholder:"\u8BF7\u9009\u62E9\u6240\u5C5E\u90E8\u95E8",modelValue:t(a).deptId,"onUpdate:modelValue":e[6]||(e[6]=s=>t(a).deptId=s)},null,8,["data","modelValue"])]),_:1},8,["label"])]),_:1}),r(n,{span:12,class:"mb20"},{default:o(()=>[r(m,{label:l.$t("sysuser.email"),prop:"email"},{default:o(()=>[r(d,{clearable:"",placeholder:"\u8BF7\u8F93\u5165\u90AE\u7BB1",modelValue:t(a).email,"onUpdate:modelValue":e[7]||(e[7]=s=>t(a).email=s)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),r(n,{span:12,class:"mb20"},{default:o(()=>[r(m,{label:l.$t("sysuser.nickname"),prop:"nickname"},{default:o(()=>[r(d,{clearable:"",placeholder:"\u8BF7\u8F93\u5165\u6635\u79F0",modelValue:t(a).nickname,"onUpdate:modelValue":e[8]||(e[8]=s=>t(a).nickname=s)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),r(n,{span:12,class:"mb20"},{default:o(()=>[r(m,{label:l.$t("sysuser.lockFlag"),prop:"lockFlag"},{default:o(()=>[r(P,{modelValue:t(a).lockFlag,"onUpdate:modelValue":e[9]||(e[9]=s=>t(a).lockFlag=s)},{default:o(()=>[(i(!0),v(_,null,y(t(D),(s,J)=>(i(),h(M,{key:J,value:s.value,border:""},{default:o(()=>[I(k(s.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1},8,["model","rules"])),[[A,t(g)]])]),_:1},8,["title","modelValue"])])}}});export{ge as default};
