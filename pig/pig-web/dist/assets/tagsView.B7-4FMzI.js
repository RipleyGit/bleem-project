const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/contextmenu.DiVgaJm6.js","assets/vue.DKOcwzik.js","assets/index.BLQPjP0P.js","assets/index.D-bKb_v8.css","assets/contextmenu.C327Hkv2.css"])))=>i.map(i=>d[i]);
import{b as te,u as ve,j as Le,o as ae,e as v,K as be,c as Ce,S as L,E as qe,d as ke,A as Re,M as se,_ as xe,__tla as De}from"./index.BLQPjP0P.js";import{a as Se,r as S,az as ie,aD as Ae,aF as Te,y as Ie,f as E,a5 as _e,Z as Pe,ao as Ue,q as $e,aI as Oe,p as Ee,ae as re,o as V,b as q,G as j,H as je,e as le,J as M,u as g,M as ne,a8 as Me,$ as k,S as R,E as F,V as Fe,aC as He,t as H}from"./vue.DKOcwzik.js";let ue,We=Promise.all([(()=>{try{return De}catch{}})()]).then(async()=>{let W,z;W=["data-url","onContextmenu","onMousedown","onClick"],z={key:0,class:"iconfont icon-webicon318 layout-navbars-tagsview-ul-li-iconfont"},ue=xe(Se({name:"layoutTagsView",setup(ze){const oe=He(()=>Ce(()=>import("./contextmenu.DiVgaJm6.js"),__vite__mapDeps([0,1,2,3,4]))),w=S([]),x=S(),K=S(),me=S(),ce=te(),he=ve(),G=te(),{themeConfig:J}=ie(he),{tagsViewRoutes:pe,favoriteRoutes:we}=ie(G),d=Le(),p=Ae(),c=Te(),s=Ie({routeActive:"",routePath:p.path,dropdown:{x:"",y:""},sortable:"",tagsRefsIndex:0,tagsViewList:[],tagsViewRoutesList:[]}),ge=E(()=>J.value.tagsStyle),m=E(()=>J.value),fe=E(()=>t=>ae.setMenuI18n(t)),D=t=>m.value.isShareTagsView?t.path===s.routePath:(t.query&&Object.keys(t.query).length||t.params&&Object.keys(t.params).length)&&t.url?t.url===s.routeActive:t.path===s.routeActive,f=t=>{L.set("tagsViewList",t)},X=async()=>{s.routeActive=await y(p),s.routePath=await p.meta.isDynamic?p.meta.isDynamicPath:p.path,s.tagsViewList=[],s.tagsViewRoutesList=pe.value,ye()},ye=async()=>{L.get("tagsViewList")&&m.value.isCacheTagsView?s.tagsViewList=await L.get("tagsViewList"):(await s.tagsViewRoutesList.map(t=>{var e;(e=t.meta)!=null&&e.isAffix&&!t.meta.isHide&&(t.url=y(t),s.tagsViewList.push({...t}),d.addCachedView(t))}),await A(p.path,p)),Q(m.value.isShareTagsView?s.routePath:s.routeActive)},Y=async(t,e)=>{var r,i;let a=(r=e==null?void 0:e.meta)!=null&&r.isDynamic?e.meta.isDynamicPath:t;if(s.tagsViewList.filter(u=>{var n,l;return u.path===a&&se((n=e==null?void 0:e.meta)!=null&&n.isDynamic?u.params?u.params:null:u.query?u.query:null,(l=e==null?void 0:e.meta)!=null&&l.isDynamic?e!=null&&e.params?e==null?void 0:e.params:null:e!=null&&e.query?e==null?void 0:e.query:null)}).length<=0){let u=s.tagsViewRoutesList.find(n=>n.path===a);if(!u||u.meta.isAffix||u.meta.isLink&&!u.meta.isIframe)return!1;(i=e==null?void 0:e.meta)!=null&&i.isDynamic?u.params=e.params:u.query=e==null?void 0:e.query,u.url=y(u),s.tagsViewList.push({...u}),await d.addCachedView(u),f(s.tagsViewList)}},Z=(t,e)=>{var r;let a=(r=e==null?void 0:e.meta)!=null&&r.isDynamic?e.meta.isDynamicPath:t;s.tagsViewList.forEach(i=>{var u,n,l;i.path!==a||se((u=e==null?void 0:e.meta)!=null&&u.isDynamic?i.params?i.params:null:i.query?i.query:null,(n=e==null?void 0:e.meta)!=null&&n.isDynamic?e!=null&&e.params?e==null?void 0:e.params:null:e!=null&&e.query?e==null?void 0:e.query:null)||((l=e==null?void 0:e.meta)!=null&&l.isDynamic?i.params=e.params:i.query=e==null?void 0:e.query,i.url=y(i),f(s.tagsViewList))})},A=(t,e)=>{H(async()=>{var r,i,u;let a;if((r=e==null?void 0:e.meta)!=null&&r.isDynamic){if(m.value.isShareTagsView?await Z(t,e):await Y(t,e),s.tagsViewList.some(n=>{var l;return n.path===((l=e==null?void 0:e.meta)==null?void 0:l.isDynamicPath)}))return f(s.tagsViewList),!1;a=s.tagsViewRoutesList.find(n=>{var l;return n.path===((l=e==null?void 0:e.meta)==null?void 0:l.isDynamicPath)})}else{if(m.value.isShareTagsView?await Z(t,e):await Y(t,e),s.tagsViewList.some(n=>n.path===t))return f(s.tagsViewList),!1;a=s.tagsViewRoutesList.find(n=>n.path===t)}return!!a&&!((i=a==null?void 0:a.meta)!=null&&i.isLink&&!a.meta.isIframe)&&((u=e==null?void 0:e.meta)!=null&&u.isDynamic?a.params=e!=null&&e.params?e==null?void 0:e.params:p.params:a.query=e!=null&&e.query?e==null?void 0:e.query:p.query,a.url=y(a),await d.addCachedView(a),await s.tagsViewList.push({...a}),void await f(s.tagsViewList))})},B=async t=>{var r;const e=decodeURI(t);let a={};if(s.tagsViewList.forEach(i=>{i.transUrl=C(i),i.transUrl?i.transUrl===C(i)&&(a=i):i.path===e&&(a=i)}),!a)return!1;await d.delCachedView(a),v.emit("onTagsViewRefreshRouterView",t),(r=a.meta)!=null&&r.isKeepAlive&&d.addCachedView(a)},T=t=>{s.tagsViewList.map((e,a,r)=>{var i;(i=e.meta)!=null&&i.isAffix||(m.value.isShareTagsView?e.path===t:e.url===t)&&(d.delCachedView(e),s.tagsViewList.splice(a,1),setTimeout(()=>{(s.tagsViewList.length===a&&m.value.isShareTagsView?s.routePath===t:s.routeActive===t)?r[r.length-1].meta.isDynamic?a!==r.length?c.push({name:r[a].name,params:r[a].params}):c.push({name:r[r.length-1].name,params:r[r.length-1].params}):a!==r.length?c.push({path:r[a].path,query:r[a].query}):c.push({path:r[r.length-1].path,query:r[r.length-1].query}):(s.tagsViewList.length!==a&&m.value.isShareTagsView?s.routePath===t:s.routeActive===t)&&(r[a].meta.isDynamic?c.push({name:r[a].name,params:r[a].params}):c.push({path:r[a].path,query:r[a].query}))},0))}),f(s.tagsViewList)},N=t=>{let e={};return s.tagsViewList.forEach(a=>{a.transUrl=C(a),a.transUrl?a.transUrl===C(a)&&a.transUrl===t.commonUrl&&(e=a):a.path===decodeURI(t.path)&&(e=a)}),e||null},I=async t=>{if(t.commonUrl=C(t),!N(t))return qe({type:"warning",message:"\u8BF7\u6B63\u786E\u8F93\u5165\u8DEF\u5F84\u53CA\u5B8C\u6574\u53C2\u6570\uFF08query\u3001params\uFF09"});const{path:e,name:a,params:r,query:i,meta:u,url:n}=N(t);switch(t.contextMenuClickId){case 0:u.isDynamic?await c.push({name:a,params:r}):await c.push({path:e,query:i}),B(p.fullPath);break;case 1:T(m.value.isShareTagsView?e:n);break;case 2:u.isDynamic?await c.push({name:a,params:r}):await c.push({path:e,query:i}),(l=>{L.get("tagsViewList")&&(s.tagsViewList=[],L.get("tagsViewList").map(o=>{var h;(h=o.meta)!=null&&h.isAffix&&!o.meta.isHide&&(o.url=y(o),d.delOthersCachedViews(o),s.tagsViewList.push({...o}))}),A(l,p),f(s.tagsViewList))})(e);break;case 3:L.get("tagsViewList")&&(d.delAllCachedViews(),s.tagsViewList=[],L.get("tagsViewList").map(l=>{var o;(o=l.meta)!=null&&o.isAffix&&!l.meta.isHide&&(l.url=y(l),s.tagsViewList.push({...l}),c.push({path:s.tagsViewList[s.tagsViewList.length-1].path}))}),f(s.tagsViewList));break;case 4:(async l=>{const o=s.tagsViewList.find(h=>m.value.isShareTagsView?h.path===l:h.url===l);o.meta.isDynamic?await c.push({name:o.name,params:o.params}):await c.push({name:o.name,query:o.query}),ce.setCurrenFullscreen(!0)})(m.value.isShareTagsView?e:n);break;case 5:de(t)}},de=t=>{we.value.find(e=>e.path===t.path)?ke().error("\u5DF2\u7ECF\u5B58\u5728\u6536\u85CF"):G.setFavoriteRoutes(t)},C=t=>{var r,i;let e=t.query&&Object.keys(t.query).length>0?t.query:t.params;if(!e)return"";let a="";for(let[u,n]of Object.entries(e))(r=t.meta)!=null&&r.isDynamic?a+=`/${n}`:a+=`&${u}=${n}`;return(i=t.meta)!=null&&i.isDynamic?t.isFnClick?decodeURI(t.path):`${t.path.split(":")[0]}${a.replace(/^\//,"")}`:`${t.path}${a.replace(/^&/,"?")}`},y=t=>{var r;let e=t.query&&Object.keys(t.query).length>0?t.query:t.params;if(!e||Object.keys(e).length<=0)return t.path;let a="";for(let i in e)a+=e[i];return`${(r=t.meta)!=null&&r.isDynamic?t.meta.isDynamicPath:t.path}-${a}`},Ve=t=>{x.value.$refs.wrapRef.scrollLeft+=t.wheelDelta/4},Q=t=>{H(async()=>{let e=await s.tagsViewList;s.tagsRefsIndex=e.findIndex(a=>m.value.isShareTagsView?a.path===t:a.url===t),H(()=>{if(w.value.length<=0)return!1;let a=w.value[s.tagsRefsIndex],r=s.tagsRefsIndex,i=w.value.length,u=w.value[0],n=w.value[w.value.length-1],l=x.value.$refs.wrapRef,o=l.scrollWidth,h=l.offsetWidth,b=l.scrollLeft,U=w.value[s.tagsRefsIndex-1],ee=w.value[s.tagsRefsIndex+1],$=0,O=0;a===u?l.scrollLeft=0:a===n?l.scrollLeft=o-h:($=r===0?u.offsetLeft-5:(U==null?void 0:U.offsetLeft)-5,O=r===i?n.offsetLeft+n.offsetWidth+5:ee.offsetLeft+ee.offsetWidth+5,O>b+h?l.scrollLeft=O-h:$<b&&(l.scrollLeft=$)),x.value.update()})})},_=async()=>{const t=document.querySelector(".layout-navbars-tagsview-ul");if(!t)return!1;s.sortable.el&&s.sortable.destroy(),s.sortable=Re.create(t,{animation:300,dataIdAttr:"data-url",disabled:!m.value.isSortableTagsView,onEnd:()=>{const e=[];s.sortable.toArray().map(a=>{s.tagsViewList.map(r=>{r.url===a&&e.push({...r})})}),f(e)}})},P=async()=>{await _(),ae.isMobile()&&s.sortable.el&&s.sortable.destroy()};return _e(()=>{P(),window.addEventListener("resize",P),v.on("onCurrentContextmenuClick",t=>{t.isFnClick=!0,I(t)}),v.on("openOrCloseSortable",()=>{_()}),v.on("openShareTagsView",()=>{m.value.isShareTagsView&&(c.push("/home/index"),s.tagsViewList=[],s.tagsViewRoutesList.map(t=>{var e;(e=t.meta)!=null&&e.isAffix&&!t.meta.isHide&&(t.url=y(t),s.tagsViewList.push({...t}))}))})}),Pe(()=>{v.off("onCurrentContextmenuClick",()=>{}),v.off("openOrCloseSortable",()=>{}),v.off("openShareTagsView",()=>{}),window.removeEventListener("resize",P)}),Ue(()=>{w.value=[]}),$e(()=>{X(),_()}),Oe(async t=>{s.routeActive=y(t),s.routePath=t.meta.isDynamic?t.meta.isDynamicPath:t.path,await A(t.path,t),Q(m.value.isShareTagsView?s.routePath:s.routeActive)}),Ee(be.state,t=>{if(t.tagsViewRoutes.tagsViewRoutes.length===s.tagsViewRoutesList.length)return!1;X()},{deep:!0}),(t,e)=>{const a=re("SvgIcon"),r=re("el-scrollbar");return V(),q("div",{class:M(["layout-navbars-tagsview",{"layout-navbars-tagsview-shadow":g(m).layout==="classic"}])},[j(r,{ref_key:"scrollbarRef",ref:x,onWheel:k(Ve,["prevent"])},{default:je(()=>[le("ul",{class:M(["layout-navbars-tagsview-ul",g(ge)]),ref_key:"tagsUlRef",ref:me},[(V(!0),q(ne,null,Me(g(s).tagsViewList,(i,u)=>(V(),q("li",{key:u,class:M(["layout-navbars-tagsview-ul-li",{"is-active":D(i)}]),"data-url":i.url,onContextmenu:k(n=>((l,o)=>{const{clientX:h,clientY:b}=o;s.dropdown.x=h,s.dropdown.y=b,K.value.openContextmenu(l)})(i,n),["prevent"]),onMousedown:n=>((l,o)=>{var h;if(!((h=l.meta)!=null&&h.isAffix)&&o.button===1){const b=Object.assign({},{contextMenuClickId:1,...l});I(b)}})(i,n),onClick:n=>((l,o)=>{s.tagsRefsIndex=o,c.push(l)})(i,u),ref_for:!0,ref:n=>{n&&(g(w)[u]=n)}},[D(i)?(V(),q("i",z)):R("",!0),!D(i)&&g(m).isTagsviewIcon?(V(),F(a,{key:1,name:i.meta.icon,class:"pr5"},null,8,["name"])):R("",!0),le("span",null,Fe(g(fe)(i)),1),D(i)?(V(),q(ne,{key:2},[j(a,{name:"ele-RefreshRight",class:"ml5 layout-navbars-tagsview-ul-li-refresh",onClick:e[0]||(e[0]=k(n=>B(t.$route.fullPath),["stop"]))}),i.meta.isAffix?R("",!0):(V(),F(a,{key:0,name:"ele-Close",class:"layout-navbars-tagsview-ul-li-icon layout-icon-active",onClick:k(n=>T(g(m).isShareTagsView?i.path:i.url),["stop"])},null,8,["onClick"]))],64)):R("",!0),i.meta.isAffix?R("",!0):(V(),F(a,{key:3,name:"ele-Close",class:"layout-navbars-tagsview-ul-li-icon layout-icon-three",onClick:k(n=>T(g(m).isShareTagsView?i.path:i.url),["stop"])},null,8,["onClick"]))],42,W))),128))],2)]),_:1},512),j(g(oe),{dropdown:g(s).dropdown,ref_key:"contextmenuRef",ref:K,onCurrentContextmenuClick:I},null,8,["dropdown"])],2)}}}),[["__scopeId","data-v-bb1d234d"]])});export{We as __tla,ue as default};
